<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script src="../libs/jquery-1.10.1.js"></script>
    <script src="../libs/jquery.xdomainajax.js"></script>
    <script src="../libs/d3.v3.min.js"></script>
    <script src="../libs/FileSaver.js"></script>
</head>
<body>

<script>

    // example from http://developer.rottentomatoes.com/docs/read/json/v10/examples#JavaScript

    var apikey = "5z3umud6gz3mrszrgtt8mpdu";
    var baseUrl = "http://api.rottentomatoes.com/api/public/v1.0";

    var moviesSearchUrl = baseUrl + '/movies.json?apikey=' + apikey;
    var query = "Gone with the Wind";
    var csvLines  = [];

    var headerLine = "weekDates,title,url,weeklyGross,theatreCount,totalGross,budget,week,year";
    csvLines.push(headerLine);

    d3.csv("/data/boxoffice2012master.csv", function(movieData) {
        movieData.forEach( function (d, i) {
            setTimeout(function(){  getMovieData(d); },1000);
        });

    function getMovieData (movie) {


   /*     $.ajax({
            url: moviesSearchUrl + '&q=' + encodeURI(movie.title),
            dataType: "jsonp",
            success: searchCallback,
            error: function() {
                return console.log("error");
            }
        });  */
    }

    // callback for when we get back the results
    function searchCallback(data) {
        $(document.body).append('Found ' + data.total + ' results for ' + query);
        var movies = data.movies;
        $.each(movies, function(index, movie) {
            console.log(movie);
            $(document.body).append('<h1>' + movie.title + '</h1>');
            $(document.body).append('<img src="' + movie.posters.thumbnail + '" />');
        });
    }

    /* takes an array of strings
     and writes them line by line into a file given by filename
     */
    var saveToFile = function(arrayOfLines, fileName) {
        /* adds linebreaks at the end*/
        var blob, blobText;
        blobText = arrayOfLines.map(function(d) {
            if (d.endsWith("\n")) {
                return d;
            } else {
                return d + "\n";
            }
        });
        blob = new Blob(blobText, {
            type: "text/plain;charset=utf-8"
        });
        return saveAs(blob, fileName);
    };

    String.prototype.endsWith = function(suffix) {
        return this.indexOf(suffix, this.length - suffix.length) !== -1;
    };

    });

</script>


</body>
</html>